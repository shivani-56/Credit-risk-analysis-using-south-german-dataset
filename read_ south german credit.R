{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "07f638a1",
   "metadata": {},
   "outputs": [],
   "source": [
    "dat <- read.table(\"GermanCredit/SouthGermanCredit.asc\", header=TRUE) \n",
    "\n",
    "## dat contains numbers for all variables.\n",
    "\n",
    "## variables duration, amount and age are truly quantitative\n",
    "## variables installment_rate, present_residence and number_credits are\n",
    "    ### quantitative in the data, but are in fact discretized scores for \n",
    "    ### an underlying quantitative variable\n",
    "    ### and are thus stored as ordered factors below\n",
    "## variable people_liable is quantitative in the data but is in fact \n",
    "    ### a binarized score (less 0 to 2 versus 3 or more)\n",
    "    ### and is thus stored as a factor below\n",
    "## all the numeric values (=level codes) \n",
    "    ### for the categorical variables \n",
    "    ### (including the discretized quantitative variables), \n",
    "    ### are the P2 scores from Häußler (1979) \n",
    "    ### which can be directly used in credit scoring (larger=better).\n",
    "    ### (Exceptions have been corrected in the raw data, \n",
    "    ###     which implies that columns pers and gastarb have \n",
    "    ###     entries opposite to those in Open Data LMU (2010)\n",
    "    ###     and the GermanCredit data from the UCI ML Repo.)\n",
    "\n",
    "## variable names from Fahrmeir/Hamerle book\n",
    "nam_fahrmeirbook <- colnames(dat)\n",
    "\n",
    "### assign levels \n",
    "### level assignment can be sanity-checked \n",
    "### with Table 2.1 from the Fahrmeir/Hamerle book, \n",
    "###     which gives proportions separated for good and bad credit risks.\n",
    "### That table is provided with by Open Data LMU \n",
    "###     (https://doi.org/10.5282/ubm/data.23)\n",
    "###     together with a German language version of the data set.\n",
    "### A corresponding table for the English language data is produced \n",
    "###     below for the final data (levels ordered by increasing code).\n",
    "### Level labels have been taken from package evtree, except for \n",
    "###     the variable telephone (where the yes level has been made more detailed)\n",
    "###     and those variables that were quantitative and do not have level labels\n",
    "###     in evtree.\n",
    "\n",
    "nam_evtree <- c(\"status\", \"duration\", \"credit_history\", \"purpose\", \"amount\", \n",
    "                \"savings\", \"employment_duration\", \"installment_rate\",\n",
    "                \"personal_status_sex\", \"other_debtors\",\n",
    "                \"present_residence\", \"property\",\n",
    "                \"age\", \"other_installment_plans\",\n",
    "                \"housing\", \"number_credits\",\n",
    "                \"job\", \"people_liable\", \"telephone\", \"foreign_worker\",\n",
    "                \"credit_risk\")\n",
    "names(dat) <- nam_evtree\n",
    "\n",
    "## make factors for all except the numeric variables\n",
    "## make sure that even empty level of factor purpose = verw (dat[[4]]) is included\n",
    "for (i in setdiff(1:21, c(2,4,5,13)))\n",
    "  dat[[i]] <- factor(dat[[i]])\n",
    "## factor purpose\n",
    "dat[[4]] <- factor(dat[[4]], levels=as.character(0:10))\n",
    "\n",
    "## assign level codes\n",
    "## make intrinsically ordered factors into class ordered \n",
    "levels(dat$credit_risk) <- c(\"bad\", \"good\")\n",
    "levels(dat$status) = c(\"no checking account\",\n",
    "                         \"... < 0 DM\",\n",
    "                         \"0<= ... < 200 DM\",\n",
    "                         \"... >= 200 DM / salary for at least 1 year\")\n",
    "## \"critical account/other credits elsewhere\" was\n",
    "## \"critical account/other credits existing (not at this bank)\",\n",
    "levels(dat$credit_history) <- c(\n",
    "  \"delay in paying off in the past\",\n",
    "  \"critical account/other credits elsewhere\",\n",
    "  \"no credits taken/all credits paid back duly\",\n",
    "  \"existing credits paid back duly till now\",\n",
    "  \"all credits at this bank paid back duly\")\n",
    "levels(dat$purpose) <- c(\n",
    "  \"others\",\n",
    "  \"car (new)\",\n",
    "  \"car (used)\",\n",
    "  \"furniture/equipment\",\n",
    "  \"radio/television\",\n",
    "  \"domestic appliances\",\n",
    "  \"repairs\",\n",
    "  \"education\", \n",
    "  \"vacation\",\n",
    "  \"retraining\",\n",
    "  \"business\")\n",
    "levels(dat$savings) <- c(\"unknown/no savings account\",\n",
    "                         \"... <  100 DM\", \n",
    "                         \"100 <= ... <  500 DM\",\n",
    "                         \"500 <= ... < 1000 DM\", \n",
    "                         \"... >= 1000 DM\")\n",
    "levels(dat$employment_duration) <- \n",
    "                  c(  \"unemployed\", \n",
    "                      \"< 1 yr\", \n",
    "                      \"1 <= ... < 4 yrs\",\n",
    "                      \"4 <= ... < 7 yrs\", \n",
    "                      \">= 7 yrs\")\n",
    "dat$installment_rate <- ordered(dat$installment_rate)\n",
    "levels(dat$installment_rate) <- c(\">= 35\", \n",
    "                                  \"25 <= ... < 35\",\n",
    "                                  \"20 <= ... < 25\", \n",
    "                                  \"< 20\")\n",
    "levels(dat$other_debtors) <- c(\n",
    "  \"none\",\n",
    "  \"co-applicant\",\n",
    "  \"guarantor\"\n",
    ")\n",
    "## female : nonsingle was female : divorced/separated/married\n",
    "##    widowed females are not mentioned in the code table\n",
    "levels(dat$personal_status_sex) <- c(\n",
    "  \"male : divorced/separated\",\n",
    "  \"female : non-single or male : single\",\n",
    "  \"male : married/widowed\",\n",
    "  \"female : single\")\n",
    "dat$present_residence <- ordered(dat$present_residence)\n",
    "levels(dat$present_residence) <- c(\"< 1 yr\", \n",
    "                                   \"1 <= ... < 4 yrs\", \n",
    "                                   \"4 <= ... < 7 yrs\", \n",
    "                                   \">= 7 yrs\")\n",
    "## \"building soc. savings agr./life insurance\", \n",
    "##    was \"building society savings agreement/life insurance\"\n",
    "levels(dat$property) <- c(\n",
    "  \"unknown / no property\",\n",
    "  \"car or other\",\n",
    "  \"building soc. savings agr./life insurance\", \n",
    "  \"real estate\"\n",
    ")\n",
    "levels(dat$other_installment_plans) <- c(\n",
    "  \"bank\",\n",
    "  \"stores\",\n",
    "  \"none\"\n",
    ")\n",
    "levels(dat$housing) <- c(\"for free\", \"rent\", \"own\")\n",
    "dat$number_credits <- ordered(dat$number_credits)\n",
    "levels(dat$number_credits) <- c(\"1\", \"2-3\", \"4-5\", \">= 6\")\n",
    "## manager/self-empl./highly qualif. employee  was\n",
    "##   management/self-employed/highly qualified employee/officer\n",
    "levels(dat$job) <- c(\n",
    "  \"unemployed/unskilled - non-resident\",\n",
    "  \"unskilled - resident\",\n",
    "  \"skilled employee/official\",\n",
    "  \"manager/self-empl./highly qualif. employee\"\n",
    ")\n",
    "levels(dat$people_liable) <- c(\"3 or more\", \"0 to 2\")\n",
    "levels(dat$telephone) <- c(\"no\", \"yes (under customer name)\")\n",
    "levels(dat$foreign_worker) <- c(\"yes\", \"no\")\n",
    "\n",
    "## checks against fahrmeir table\n",
    "tabs <- \n",
    "list(status = round(100*prop.table(xtabs(~status+credit_risk, dat),2),2),\n",
    "credit_history = round(100*prop.table(xtabs(~credit_history+credit_risk, dat),2),2),\n",
    "purpose = round(100*prop.table(xtabs(~purpose+credit_risk, dat),2),2),\n",
    "savings = round(100*prop.table(xtabs(~savings+credit_risk, dat),2),2),\n",
    "employment_duration = round(100*prop.table(xtabs(~employment_duration+credit_risk, dat),2),2),\n",
    "installment_rate = round(100*prop.table(xtabs(~installment_rate+credit_risk, dat),2),2),\n",
    "personal_status_sex = round(100*prop.table(xtabs(~personal_status_sex+credit_risk, dat),2),2),\n",
    "other_debtors = round(100*prop.table(xtabs(~other_debtors+credit_risk, dat),2),2),\n",
    "present_residence = round(100*prop.table(xtabs(~present_residence+credit_risk, dat),2),2),\n",
    "property = round(100*prop.table(xtabs(~property+credit_risk, dat),2),2),\n",
    "other_installment_plans = round(100*prop.table(xtabs(~other_installment_plans+credit_risk, dat),2),2),\n",
    "housing = round(100*prop.table(xtabs(~housing+credit_risk, dat),2),2),\n",
    "number_credits = round(100*prop.table(xtabs(~number_credits+credit_risk, dat),2),2),\n",
    "job = round(100*prop.table(xtabs(~job+credit_risk, dat),2),2),\n",
    "people_liable = round(100*prop.table(xtabs(~people_liable+credit_risk, dat),2),2),\n",
    "telephone = round(100*prop.table(xtabs(~telephone+credit_risk, dat),2),2),\n",
    "foreign_worker = round(100*prop.table(xtabs(~foreign_worker+credit_risk, dat),2),2))\n",
    "\n",
    "## variables for which a tab entry is available\n",
    "## (all except 2, 5 and 13)\n",
    "tabwhich <- setdiff(1:20, c(2,5,13))"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.8"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
